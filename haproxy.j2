#---------------------------------------------------------------------
# main frontend which proxys to the backends
#---------------------------------------------------------------------
frontend main
    bind *:5000
    acl url_static       path_beg       -i /static /images /javascript /stylesheets
    acl url_static       path_end       -i .jpg .gif .png .css .js

    use_backend static          if url_static
    default_backend             app

#---------------------------------------------------------------------
# static backend for serving up images, stylesheets and such
#---------------------------------------------------------------------
backend static
    balance     roundrobin
    server      static 127.0.0.1:4331 check

#---------------------------------------------------------------------
# round robin balancing between the various backends
#---------------------------------------------------------------------
backend app
    balance     roundrobin
    server {{ hostvars['node3']['ansible_facts']['ansible_hostname'] }}  {{ hostvars['node3']['ansible_facts']['ansible_default_ipv4']['address'] }}:80 check
    server {{ hostvars['node4']['ansible_facts']['ansible_hostname'] }}  {{ hostvars['node4']['ansible_facts']['ansible_default_ipv4']['address'] }}:80 check
